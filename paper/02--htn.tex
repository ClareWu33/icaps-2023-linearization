For the purpose of illustrating our approach, we first present the HTN planning formalism used throughout the paper, including the grounded one and the lifted one. % The grounded HTN formalism is based on the one by \shortCite{HTNSurvey}.

\paragraph{Grounded HTN Planning} The grounded HTN planning formalism presented is based on the one by \shortCite{HTNSurvey}. A grounded HTN planning problem is a tuple $\groundProb{} = (\domain{}, tn_{I}, s_{I})$ with $\domain{} = (\lit{}, \pTasks{}, \cTasks{}, \delta, \methods{})$ being its \emph{domain}. $\lit{}$ is a set of \emph{propositions}. $\pTasks{}$ and $\cTasks{}$ are the set of \emph{primitive tasks} (also called \emph{actions}) and of \emph{compound tasks}, respectively. $\delta: \pTasks{} \to \powerSet{\lit{}} \times \powerSet{\lit{}} \times \powerSet{\lit{}}$ is a function mapping each primitive task $a \in \pTasks{}$ to its \emph{precondition}, \emph{positive effects}, and \emph{negative effects}, written $\delta(a) = (\preCond{a}, \effPos{a}, \effNeg{a})$. In particular, applying an action $a$ in some \emph{state} $s \in \powerSet{\lit{}}$ will result in a new state $s'$ with $s' = (s \setminus \effNeg{a}) \cup \effPos{a}$, written $s \to_{a} s'$, and $a$ is said to be applicable in $s$ \emph{iff} $\preCond{a} \subseteq s$. Furthermore, we say that a state $s'$ is obtained from another one $s$ by applying an action sequence $\pi = \langle a_{1} \cdots a_{n} \rangle$ in $s$, written $s \to^{\ast}_{\pi} s'$, \emph{iff} there exists a state sequence $\langle s_{0} \cdots s_{n} \rangle$ such that $s = s_{0}$, $s' = s_{n}$, and for each $1 \leq i \leq n$, $a_{i}$ is applicable in the state $s_{i - 1}$ and $s_{i - 1} \to_{a_{i}} s_{i}$. 

Each compound task $c \in \cTasks{}$ is \emph{decomposed} (refined) into a \emph{task network} $tn$, which is essentially a partial order \emph{multiset} of tasks, by a \emph{method} $m = (c, tn)$. Formally speaking, a task network $tn$ is a triple $(T, \parOrd{}, \alpha)$ where $T$ is a set of identifier, $\parOrd{} \subseteq T \times T$ is a partial order defined over $T$, and $\alpha: T \to \pTasks{} \cup \cTasks{}$ is a function mapping each identifier to a task. $\methods{}$ in the domain is the set of methods. $tn_{I}$ and $s_{I} \in \powerSet{\lit{}}$ are the initial task network and the initial state, respectively.

%TODO: decomposition 

A \emph{solution} to an HTN planning problem is a sequence of actions $\pi = \langle a_{1} \cdots a_{n} \rangle$ such that $s_{I} \to^{\ast}_{\pi} s$ for some state $s$, and there exists a task network $tn = (T, \parOrd{}, \alpha)$ such that $tn_{I} \Rightarrow^{\ast}_{\overline{m}} tn$ for some method sequence $\overline{m}$, and $tn$ possesses a linearization $\langle t_{1} \cdots t_{n} \rangle$ with $\alpha(t_{i}) = a_{i}$ for each $1 \leq i \leq n$. A linearization of $tn$ is a total order of $T$ that respects $\parOrd{}$.

As a special case of 